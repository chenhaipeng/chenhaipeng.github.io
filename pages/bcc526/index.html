<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Elasticsearch常用命令 | Hiper&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="技术博客,专注摸鱼">
    <meta name="keywords" content="java、go、大数据、云原生">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.fdc02eb1.css" as="style"><link rel="preload" href="/assets/js/app.d3e05205.js" as="script"><link rel="preload" href="/assets/js/2.fe8aed19.js" as="script"><link rel="preload" href="/assets/js/16.3a2f9fc9.js" as="script"><link rel="prefetch" href="/assets/js/10.07523ab0.js"><link rel="prefetch" href="/assets/js/100.3ec8fc98.js"><link rel="prefetch" href="/assets/js/101.b6dbcf2f.js"><link rel="prefetch" href="/assets/js/102.68005685.js"><link rel="prefetch" href="/assets/js/103.a7de64e5.js"><link rel="prefetch" href="/assets/js/104.b60ac8d6.js"><link rel="prefetch" href="/assets/js/105.de89b73c.js"><link rel="prefetch" href="/assets/js/106.3fea30ed.js"><link rel="prefetch" href="/assets/js/107.d5b4d80a.js"><link rel="prefetch" href="/assets/js/108.0d14d22f.js"><link rel="prefetch" href="/assets/js/109.6c86b7bc.js"><link rel="prefetch" href="/assets/js/11.e7c9ff68.js"><link rel="prefetch" href="/assets/js/110.bbcd4fc2.js"><link rel="prefetch" href="/assets/js/111.b8ba1824.js"><link rel="prefetch" href="/assets/js/112.7747a0cb.js"><link rel="prefetch" href="/assets/js/113.af2bbba1.js"><link rel="prefetch" href="/assets/js/114.9bcdd4d6.js"><link rel="prefetch" href="/assets/js/115.9aec1069.js"><link rel="prefetch" href="/assets/js/116.782e83e8.js"><link rel="prefetch" href="/assets/js/117.6aecceb2.js"><link rel="prefetch" href="/assets/js/118.1f15ab0c.js"><link rel="prefetch" href="/assets/js/119.d4069cc5.js"><link rel="prefetch" href="/assets/js/12.3881c5d2.js"><link rel="prefetch" href="/assets/js/120.c20a4bea.js"><link rel="prefetch" href="/assets/js/121.f53acd71.js"><link rel="prefetch" href="/assets/js/122.5edd8a9d.js"><link rel="prefetch" href="/assets/js/123.e9bddb25.js"><link rel="prefetch" href="/assets/js/124.55ba84d3.js"><link rel="prefetch" href="/assets/js/125.8cc1b6e2.js"><link rel="prefetch" href="/assets/js/126.f5f4d974.js"><link rel="prefetch" href="/assets/js/127.986ef6a0.js"><link rel="prefetch" href="/assets/js/128.d4ddc101.js"><link rel="prefetch" href="/assets/js/13.48b00a83.js"><link rel="prefetch" href="/assets/js/14.aff37911.js"><link rel="prefetch" href="/assets/js/15.d06f7fce.js"><link rel="prefetch" href="/assets/js/17.05769f3c.js"><link rel="prefetch" href="/assets/js/18.1c7dd6ba.js"><link rel="prefetch" href="/assets/js/19.367be8a9.js"><link rel="prefetch" href="/assets/js/20.bcf3c951.js"><link rel="prefetch" href="/assets/js/21.831e505c.js"><link rel="prefetch" href="/assets/js/22.ef34e56c.js"><link rel="prefetch" href="/assets/js/23.2d2c0580.js"><link rel="prefetch" href="/assets/js/24.c318ecf7.js"><link rel="prefetch" href="/assets/js/25.42b3da43.js"><link rel="prefetch" href="/assets/js/26.f265b53a.js"><link rel="prefetch" href="/assets/js/27.ef8e6c69.js"><link rel="prefetch" href="/assets/js/28.457f1560.js"><link rel="prefetch" href="/assets/js/29.42224867.js"><link rel="prefetch" href="/assets/js/3.53741393.js"><link rel="prefetch" href="/assets/js/30.0530d84e.js"><link rel="prefetch" href="/assets/js/31.a930af92.js"><link rel="prefetch" href="/assets/js/32.2441b370.js"><link rel="prefetch" href="/assets/js/33.c34bff9e.js"><link rel="prefetch" href="/assets/js/34.c8d0bb4c.js"><link rel="prefetch" href="/assets/js/35.fa9bcd14.js"><link rel="prefetch" href="/assets/js/36.1085711f.js"><link rel="prefetch" href="/assets/js/37.0031df00.js"><link rel="prefetch" href="/assets/js/38.c6270cec.js"><link rel="prefetch" href="/assets/js/39.56ae6fdc.js"><link rel="prefetch" href="/assets/js/4.9aa31843.js"><link rel="prefetch" href="/assets/js/40.e5ecf5a1.js"><link rel="prefetch" href="/assets/js/41.3a159d08.js"><link rel="prefetch" href="/assets/js/42.8a712434.js"><link rel="prefetch" href="/assets/js/43.2bfb408c.js"><link rel="prefetch" href="/assets/js/44.e18962ee.js"><link rel="prefetch" href="/assets/js/45.e5b3d10a.js"><link rel="prefetch" href="/assets/js/46.4e306e11.js"><link rel="prefetch" href="/assets/js/47.35d36bec.js"><link rel="prefetch" href="/assets/js/48.fab1e7e5.js"><link rel="prefetch" href="/assets/js/49.6129f567.js"><link rel="prefetch" href="/assets/js/5.4a96f8fa.js"><link rel="prefetch" href="/assets/js/50.254ebb8c.js"><link rel="prefetch" href="/assets/js/51.6cf7da72.js"><link rel="prefetch" href="/assets/js/52.560bd9ad.js"><link rel="prefetch" href="/assets/js/53.c0aa255d.js"><link rel="prefetch" href="/assets/js/54.693cbdbd.js"><link rel="prefetch" href="/assets/js/55.61d98229.js"><link rel="prefetch" href="/assets/js/56.c0cb425d.js"><link rel="prefetch" href="/assets/js/57.61a0edfe.js"><link rel="prefetch" href="/assets/js/58.2135ea1a.js"><link rel="prefetch" href="/assets/js/59.31fd0bf4.js"><link rel="prefetch" href="/assets/js/6.3b27ecc2.js"><link rel="prefetch" href="/assets/js/60.c3efaefc.js"><link rel="prefetch" href="/assets/js/61.26492940.js"><link rel="prefetch" href="/assets/js/62.917db43b.js"><link rel="prefetch" href="/assets/js/63.27a5485d.js"><link rel="prefetch" href="/assets/js/64.26333676.js"><link rel="prefetch" href="/assets/js/65.68c9e125.js"><link rel="prefetch" href="/assets/js/66.086a9190.js"><link rel="prefetch" href="/assets/js/67.b45a4b78.js"><link rel="prefetch" href="/assets/js/68.b0c264f5.js"><link rel="prefetch" href="/assets/js/69.9f4e6bcb.js"><link rel="prefetch" href="/assets/js/7.79539e00.js"><link rel="prefetch" href="/assets/js/70.bfb241d7.js"><link rel="prefetch" href="/assets/js/71.ba7d3a07.js"><link rel="prefetch" href="/assets/js/72.751a2acd.js"><link rel="prefetch" href="/assets/js/73.c79db6e4.js"><link rel="prefetch" href="/assets/js/74.f8d0241b.js"><link rel="prefetch" href="/assets/js/75.52a047a2.js"><link rel="prefetch" href="/assets/js/76.d60812c5.js"><link rel="prefetch" href="/assets/js/77.3cb4d227.js"><link rel="prefetch" href="/assets/js/78.41b3a677.js"><link rel="prefetch" href="/assets/js/79.d5ebc17b.js"><link rel="prefetch" href="/assets/js/8.56b87b81.js"><link rel="prefetch" href="/assets/js/80.84467a30.js"><link rel="prefetch" href="/assets/js/81.51f88037.js"><link rel="prefetch" href="/assets/js/82.2a4afb79.js"><link rel="prefetch" href="/assets/js/83.bf558daa.js"><link rel="prefetch" href="/assets/js/84.319a1e12.js"><link rel="prefetch" href="/assets/js/85.1ccbcd3e.js"><link rel="prefetch" href="/assets/js/86.9ae04c7e.js"><link rel="prefetch" href="/assets/js/87.bd87229a.js"><link rel="prefetch" href="/assets/js/88.e1bd102c.js"><link rel="prefetch" href="/assets/js/89.6922ceb2.js"><link rel="prefetch" href="/assets/js/9.cc927642.js"><link rel="prefetch" href="/assets/js/90.0475148c.js"><link rel="prefetch" href="/assets/js/91.d1d95ef3.js"><link rel="prefetch" href="/assets/js/92.1a87d776.js"><link rel="prefetch" href="/assets/js/93.6b5a0db5.js"><link rel="prefetch" href="/assets/js/94.c44fe8e6.js"><link rel="prefetch" href="/assets/js/95.d2fdc4a0.js"><link rel="prefetch" href="/assets/js/96.f5236967.js"><link rel="prefetch" href="/assets/js/97.46798252.js"><link rel="prefetch" href="/assets/js/98.09bfce21.js"><link rel="prefetch" href="/assets/js/99.004ad8b0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fdc02eb1.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Hiper's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7e9402/" class="nav-link">Java</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/go/" class="nav-link">《Go》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/bigdata/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>大数据文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bcc526/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Elasticsearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloud/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2e4348/" class="nav-link">docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源协同" class="dropdown-title"><a href="/opensource/" class="link-title">开源协同</a> <span class="title" style="display:none;">开源协同</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/skywalking/" class="nav-link">skywalking</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="效率工具" class="dropdown-title"><a href="/tools/" class="link-title">效率工具</a> <span class="title" style="display:none;">效率工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/chenhaipeng" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://blog-1305251267.cos.ap-shenzhen-fsi.myqcloud.com/img/1.jpeg"> <div class="blogger-info"><h3>Hiper</h3> <span>摸鱼大赛🏆</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>后端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/7e9402/" class="nav-link">Java</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/go/" class="nav-link">《Go》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="大数据" class="dropdown-title"><a href="/bigdata/" class="link-title">大数据</a> <span class="title" style="display:none;">大数据</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>大数据文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bcc526/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Elasticsearch</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><a href="/cloud/" class="link-title">云原生</a> <span class="title" style="display:none;">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>云原生文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/2e4348/" class="nav-link">docker</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源协同" class="dropdown-title"><a href="/opensource/" class="link-title">开源协同</a> <span class="title" style="display:none;">开源协同</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>项目</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/skywalking/" class="nav-link">skywalking</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="效率工具" class="dropdown-title"><a href="/tools/" class="link-title">效率工具</a> <span class="title" style="display:none;">效率工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">《Git》学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/chenhaipeng" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Elasticsearch文章</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/aa5cb7/" class="sidebar-link">Elasticsearch 架构</a></li><li><a href="/pages/bcc526/" aria-current="page" class="active sidebar-link">Elasticsearch常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/bcc526/#curl语法讲解" class="sidebar-link">CURL语法讲解</a></li><li class="sidebar-sub-header level2"><a href="/pages/bcc526/#集群管控" class="sidebar-link">集群管控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#cat" class="sidebar-link">_cat</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bcc526/#文档处理" class="sidebar-link">文档处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#elasticsearch-curd语法" class="sidebar-link">Elasticsearch CURD语法</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#create创建索引及文档" class="sidebar-link">Create创建索引及文档</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#index创建索引文档或更新" class="sidebar-link">Index创建索引文档或更新</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#read查询文档" class="sidebar-link">Read查询文档</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#update更新文档" class="sidebar-link">Update更新文档</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#delete删除文档" class="sidebar-link">Delete删除文档</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#bulk-api-批量操作" class="sidebar-link">Bulk API 批量操作</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#mget-批量读取" class="sidebar-link">MGET 批量读取</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#msearch-批量查询" class="sidebar-link">MSEARCH 批量查询</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#常见错误返回" class="sidebar-link">常见错误返回</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bcc526/#常用快捷shell处理" class="sidebar-link">常用快捷shell处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#批量降副本" class="sidebar-link">批量降副本</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#创建账号密码" class="sidebar-link">创建账号密码</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#清理索引" class="sidebar-link">清理索引</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#统计某类索引空间大小" class="sidebar-link">统计某类索引空间大小</a></li><li class="sidebar-sub-header level3"><a href="/pages/bcc526/#elasticsearch查询文档总数" class="sidebar-link">Elasticsearch查询文档总数</a></li></ul></li></ul></li><li><a href="/pages/c0183f/" class="sidebar-link">Elasticsearch 集群迁移</a></li><li><a href="/pages/66fb7f/" class="sidebar-link">Elasticsearch 聚合搜索</a></li><li><a href="/pages/c906ba/" class="sidebar-link">Elasticsearch 常见问题与踩坑</a></li><li><a href="/pages/84d4c3/" class="sidebar-link">Elasticsearch 骚操作需求场景</a></li><li><a href="/pages/7a2a1c/" class="sidebar-link">Elasticsearch grok</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flink</span> <span class="arrow right"></span></p> <!----></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/bigdata/#大数据" data-v-1baff76c>大数据</a></li><li data-v-1baff76c><a href="/bigdata/#Elasticsearch文章" data-v-1baff76c>Elasticsearch文章</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="https://github.com/chenhaipeng" target="_blank" title="作者" class="beLink" data-v-1baff76c>Hiper</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2021-07-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Elasticsearch常用命令<!----></h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h1 id="elasticsearch常用命令"><a href="#elasticsearch常用命令" class="header-anchor">#</a> Elasticsearch常用命令</h1> <blockquote><ul><li>参考文档：https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html</li> <li>Elasticsearch基本CURD操作 https://zhuanlan.zhihu.com/p/162699921</li></ul></blockquote> <h2 id="curl语法讲解"><a href="#curl语法讲解" class="header-anchor">#</a> <strong>CURL语法讲解</strong></h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>RESTful API:
        <span class="token function">curl</span>  -X<span class="token operator">&lt;</span>VERB<span class="token operator">&gt;</span> <span class="token string">'&lt;PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY_STRING&gt;'</span> -d <span class="token string">'&lt;BODY&gt;'</span>
        -X：指定请求方式
            
        <span class="token operator">&lt;</span>VERB<span class="token operator">&gt;</span>：GET,POST,PUT,DELETE   一般请求为GET、提交变更为POST、上传文件为PUT、删除操作为DELETE
            
        <span class="token operator">&lt;</span>PROTOCOL<span class="token operator">&gt;</span>：协议，一般为HTTP协议
                
        <span class="token operator">&lt;</span>HOST<span class="token operator">&gt;</span>：主机，可为主机的IP地址或Hostname
            
        <span class="token operator">&lt;</span>PORT<span class="token operator">&gt;</span>：主机端口
            
        <span class="token operator">&lt;</span><span class="token environment constant">PATH</span><span class="token operator">&gt;</span>：路径，主机端口后的路径，如下几个路径：/_cat, /_search, /_cluster   /_cat路径覆盖了大多数的信息内容,/_search为搜索所有的索引和文档类型
            
        <span class="token operator">&lt;</span>QUERY_STRING<span class="token operator">&gt;</span>：查询字符串匹配规则
            
        -d：指定主体内容
            
        <span class="token operator">&lt;</span>BODY<span class="token operator">&gt;</span>：json格式的请求主体
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="集群管控"><a href="#集群管控" class="header-anchor">#</a> 集群管控</h2> <h3 id="cat"><a href="#cat" class="header-anchor">#</a> _cat</h3> <blockquote><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.13/cat-health.html" target="_blank" rel="noopener noreferrer">_cat<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 注意查看集群监控信息、例如集群健康，索引磁盘大小等,比较常用的命令</p></blockquote> <h4 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#查询占用空间大索引存存储</span>
GET /_cat/indices/*?v<span class="token operator">&amp;</span><span class="token assign-left variable">s</span><span class="token operator">=</span>store.size:desc
<span class="token comment">#或者</span>
<span class="token function">curl</span> <span class="token string">'http://localhost:9200/_cat/indices?v'</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">open</span> <span class="token operator">|</span> <span class="token function">sort</span> -k9
<span class="token comment">#或者</span>
GET /_cat/indices?v<span class="token operator">&amp;</span><span class="token assign-left variable">health</span><span class="token operator">=</span>green
<span class="token comment">#按照文档数量排序索引</span>
GET _cat/indices?v<span class="token operator">&amp;</span><span class="token assign-left variable">s</span><span class="token operator">=</span>docs.count:desc
<span class="token comment">#查看各个索引占用内存大小并进行排序</span>
GET /_cat/indices?v<span class="token operator">&amp;</span><span class="token assign-left variable">h</span><span class="token operator">=</span>i,tm<span class="token operator">&amp;</span><span class="token assign-left variable">s</span><span class="token operator">=</span>tm:desc
<span class="token comment">#查看单个索引信息</span>
GET /_cat/indices/movies?v
<span class="token comment">#查看指定索引文档总数</span>
GET movies/_count
<span class="token comment">#查看movies索引元数据 mapping setting 等定义</span>
GET movies
<span class="token comment">#查看模板</span>
GET _cat/templates 
GET /_template/template_1
或者
GET /_index_template/template_1
<span class="token comment"># 更新模板</span>
PUT /_index_template/template_1
<span class="token punctuation">{</span>
  <span class="token string">&quot;index_patterns&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;te*&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;priority&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
  <span class="token string">&quot;template&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;settings&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;number_of_shards&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
或者
PUT _template/template_1
<span class="token punctuation">{</span>
  <span class="token string">&quot;index_patterns&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;te*&quot;</span>, <span class="token string">&quot;bar*&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;settings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;number_of_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;_source&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;enabled&quot;</span><span class="token builtin class-name">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;host_name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;keyword&quot;</span>
      <span class="token punctuation">}</span>,
      <span class="token string">&quot;created_at&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;date&quot;</span>,
        <span class="token string">&quot;format&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;EEE MMM dd HH:mm:ss Z yyyy&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h4 id="集群"><a href="#集群" class="header-anchor">#</a> 集群</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#查看集群状态</span>
GET /_cat/health?v<span class="token operator">=</span>true
GET _cluster/health
<span class="token comment">#集群停机升级的时候比较有用，或者</span>
<span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">curl</span> localhost:9200/_cat/health<span class="token punctuation">;</span> <span class="token function">sleep</span> <span class="token number">120</span><span class="token punctuation">;</span> <span class="token keyword">done</span>

<span class="token comment">#查看主节点信息</span>
kibana: GET /_cat/master?v
bash: <span class="token function">curl</span> -XGET -u elastic:26tBktGolYCyZD2pPISW <span class="token string">'http://localhost:9200/_cat/master?v'</span>

<span class="token comment">#查看集群所有节点</span>
GET /_cat/nodes?v

<span class="token comment">#查看单个索引分片信息</span>
GET /_cat/shards/movies?v

<span class="token comment">#查看插件</span>
GET /_cat/plugins?v

<span class="token comment">#查看所有索引文档总数</span>
GET _all/_count

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="文档处理"><a href="#文档处理" class="header-anchor">#</a> 文档处理</h2> <h3 id="elasticsearch-curd语法"><a href="#elasticsearch-curd语法" class="header-anchor">#</a> <strong>Elasticsearch CURD语法</strong></h3> <p><strong>CURD请求方式主体说明</strong></p> <p><strong>Create</strong> <code>PUT/index/_create/id</code>指定Document ID，创建文档，如果ID已存在，则失败<strong>Create</strong> <code>POST/index/_create/id</code>指定Document ID，创建文档，如果ID已存在，则失败<strong>Create</strong> <code>POST/index/_doc</code>自动生成ID，不会重复，重复提交则创建多个文档，文档版本都为1,<code>Index PUT/index/_doc/id</code>如果ID不存在,则创建新的文档,如果ID存在,则删除现有文档后创建新的文档,版本+1,ID相同<code>Index POST/index/_doc/id</code>如果ID不存在,则创建新的文档,如果ID存在,则删除现有文档后创建新的文档,版本+1,ID相同<code>Read GET/index/_doc/id</code>查看Document ID为1的文档<strong>Update</strong> <code>POST/index/_doc/id</code>文档必须存在,否则更新失败,只能增量修改字段,不能减少字段,字段值可以随意修改,版本加1，<strong>Delete</strong> <code>Delete/index/_doc/id</code>文档必须存在,否则删除返回&quot;not_found&quot; <strong>Delete</strong> <code>Delete/index</code>删除索引，索引内的文档也会被随之而删除,要删除的索引必须存在,否则返回 &quot;404&quot;</p> <h3 id="create创建索引及文档"><a href="#create创建索引及文档" class="header-anchor">#</a> <strong>Create创建索引及文档</strong></h3> <p>Create一个文档时，Elasticsearch支持自动生成文档ID和指定文档ID两种方式。</p> <ol><li>通过调用 <code>POST /index/_doc</code> 语法，系统自动生成文档Document ID。此种方法，即使创建的JSON文档重复，Document ID也不一致，如果重复使用POST多次提交，Elasticsearch将会创建多个内容重复但ID不一致的文档。</li> <li>通过调用 <code>POST /index/_create/id</code>或<code>PUT /index/_create/id</code>语法，则手动指定生成Document ID，此种方法，如果我们指定ID的文档已存在，则创建失败，反正创建文档。</li></ol> <p><strong>实例</strong> <code>自动生成 Document ID</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#Kibana语法</span>
POST /index/_doc
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;WeiLiang Xu&quot;</span>,
  <span class="token string">&quot;Blogs&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;abcops.cn&quot;</span>,
  <span class="token string">&quot;Is male&quot;</span><span class="token builtin class-name">:</span> true,
  <span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>
<span class="token punctuation">}</span>

<span class="token comment">#Bash语法</span>
<span class="token function">curl</span> -XPOST -u elastic:26tBktGolYCyZD2pPISW -H <span class="token string">&quot;Content-Type:application/json&quot;</span> <span class="token string">'http://192.168.31.215:9201/index/_doc?pretty'</span> -d <span class="token string">'
{
  &quot;name&quot;: &quot;WeiLiang Xu&quot;,
  &quot;Blogs&quot;: &quot;abcops.cn&quot;,
  &quot;Is male&quot;: true,
  &quot;age&quot;: 25
}
POST 请求指定 Document ID
#Kibana POST请求语法
POST /index/_create/1
{
  &quot;name&quot;: &quot;WeiLiang Xu&quot;,
  &quot;Blogs&quot;: &quot;abcops.cn&quot;,
  &quot;Is male&quot;: true,
  &quot;age&quot;: 25
}

#Bash POST请求语法
curl -XPOST -u elastic:26tBktGolYCyZD2pPISW -H &quot;Content-Type:application/json&quot; '</span>http://192.168.31.215:9201/index/_create/1?pretty<span class="token string">' -d '</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;WeiLiang Xu&quot;</span>,
  <span class="token string">&quot;Blogs&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;abcops.cn&quot;</span>,
  <span class="token string">&quot;Is male&quot;</span><span class="token builtin class-name">:</span> true,
  <span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>
<span class="token punctuation">}</span><span class="token string">'
PUT请求指定 Document ID
#Kibana PUT请求语法
PUT /index/_create/1
{
  &quot;name&quot;: &quot;WeiLiang Xu&quot;,
  &quot;Blogs&quot;: &quot;abcops.cn&quot;,
  &quot;Is male&quot;: true,
  &quot;age&quot;: 25
}

#Bash PUT请求语法
curl -XPUT -u elastic:26tBktGolYCyZD2pPISW -H &quot;Content-Type:application/json&quot; '</span>http://192.168.31.215:9201/index/_create/1?pretty<span class="token string">' -d '</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;WeiLiang Xu&quot;</span>,
  <span class="token string">&quot;Blogs&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;abcops.cn&quot;</span>,
  <span class="token string">&quot;Is male&quot;</span><span class="token builtin class-name">:</span> true,
  <span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>
<span class="token punctuation">}</span>'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="index创建索引文档或更新"><a href="#index创建索引文档或更新" class="header-anchor">#</a> <strong>Index创建索引文档或更新</strong></h3> <p>Index语法可以有两种HTTP请求方式，分别是 <code>POST</code>和<code>PUT</code>，这种请求方法通过调用 <code>/index/_doc/id</code> 语法，指定了 Document ID来创建文档，如果Document ID不存在，则创建为新的文档，如果ID存在，则删除现有ID后创建新的文档，Document Version会进行 + 1。 Index方式的原理是：如果文档已存在，先删除原有文档，然后再进行新增文档，版本+1。</p> <p><strong>实例</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#Kibana操作</span>
POST /index/_doc/6              <span class="token comment">#PUT语法只需要把 POST 改为 PUT即可</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;WeiLiang Xu&quot;</span>,
  <span class="token string">&quot;Blogs&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;abcops.cn&quot;</span>,
  <span class="token string">&quot;Is male&quot;</span><span class="token builtin class-name">:</span> true,
  <span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>
<span class="token punctuation">}</span>

<span class="token comment">#Bash操作</span>
<span class="token function">curl</span> -XPUT -u elastic:26tBktGolYCyZD2pPISW -H <span class="token string">&quot;Content-Type:application/json&quot;</span> <span class="token string">'http://192.168.31.215:9201/index/_doc/6?pretty'</span> -d <span class="token string">'
{
  &quot;name&quot;: &quot;WeiLiang Xu&quot;,
  &quot;Blogs&quot;: &quot;abcops.cn&quot;,
  &quot;Is male&quot;: true,
  &quot;age&quot;: 25
}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="read查询文档"><a href="#read查询文档" class="header-anchor">#</a> <strong>Read查询文档</strong></h3> <p>Read为读取文档内容，Read使用的HTTP请求方式为 GET ，</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#Kibana操作</span>
GET /index/_doc/1                   <span class="token comment">#操作index索引中Document ID为1的文档</span>

<span class="token comment">#Bash操作</span>
<span class="token function">curl</span> -XGET -u elastic:26tBktGolYCyZD2pPISW <span class="token string">'http://192.168.31.215:9201/index/_doc/1?pretty'</span>

<span class="token comment">#更多的GET语法见文章顶部</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="update更新文档"><a href="#update更新文档" class="header-anchor">#</a> <strong>Update更新文档</strong></h3> <p>Update方法与Index不同的是，Update在更新文档的时候不会删除原来的文档，而是真正的更新数据。 Update更新的文档必须真实存在，Update更新只能对字段进行增量修改，对字段值可以进行随意更改，不能对文档字段进行减少更新。如果你需要减少字段，则使用Index去操作文档。</p> <p><strong>实例</strong></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#Kibana操作</span>
POST /weiliang/_update/1
<span class="token punctuation">{</span>
  <span class="token string">&quot;doc&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;weiliang Xu&quot;</span>,<span class="token string">&quot;xueiliang&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;JobS&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Linux DevOps&quot;</span>,
  <span class="token string">&quot;Age&quot;</span><span class="token builtin class-name">:</span> <span class="token number">25</span>,
  <span class="token string">&quot;gender&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;man&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#Bash操作</span>
<span class="token function">curl</span> -XPOST -u elastic:26tBktGolYCyZD2pPISW -H <span class="token string">&quot;Content-Type:application/json&quot;</span> <span class="token string">'http://192.168.31.215:9201/weiliang/_update/1?pretty'</span> -d <span class="token string">'
{
  &quot;doc&quot;: {
  &quot;name&quot;: [&quot;weiliang Xu&quot;,&quot;xueiliang&quot;],
  &quot;JobS&quot;: &quot;Linux DevOps&quot;,
  &quot;Age&quot;: 25,
  &quot;gender&quot;: &quot;man&quot;
  }
}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="delete删除文档"><a href="#delete删除文档" class="header-anchor">#</a> <strong>Delete删除文档</strong></h3> <p>Delete可以指定Document ID删除文档，也可以直接删除索引，删除索引，索引内的文档都随之被删除。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#Kibana操作</span>
DELETE /weiliang/_doc/1         <span class="token comment">#删除指定文档</span>
DELETE /weiliang                <span class="token comment">#删除索引</span>

<span class="token comment">#Bash操作</span>
<span class="token function">curl</span> -XDELETE -u elastic:26tBktGolYCyZD2pPISW -H <span class="token string">&quot;Content-Type:application/json&quot;</span> <span class="token string">'http://192.168.31.215:9201/weiliang/_doc/1?pretty'</span>
<span class="token function">curl</span> -XDELETE -u elastic:26tBktGolYCyZD2pPISW -H <span class="token string">&quot;Content-Type:application/json&quot;</span> <span class="token string">'http://192.168.31.215:9201/weiliang?pretty'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="bulk-api-批量操作"><a href="#bulk-api-批量操作" class="header-anchor">#</a> <strong>Bulk API 批量操作</strong></h3> <ol><li>支持在一次API调用中，对不同索引进行操作</li> <li>支持四种操作 <code>Index</code>、<code>Create</code>、<code>Update</code>、<code>Delete</code></li> <li>可以在 URI 中指定 Index，也可以在请求的 Playoad 中进行</li> <li>操作中单条语句操作失败，不会影响后续操作</li> <li>返回结果包含了每一条的执行结果</li></ol> <p><strong>实例</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>#Kibana操作
POST _bulk
<span class="token punctuation">{</span> <span class="token property">&quot;create&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>             <span class="token comment">//创建了索引为 bulk_index ，id为1的文档              </span>
<span class="token punctuation">{</span> <span class="token property">&quot;Job&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Linux Ops&quot;</span> <span class="token punctuation">}</span>                                             <span class="token comment">//文档内容为字段 &quot;Job&quot; 值 &quot;Linux Ops&quot;</span>
<span class="token punctuation">{</span> <span class="token property">&quot;delete&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>             <span class="token comment">//删除索引为 bulk_index 中 id 为 2的文档，因为我们暂时还没有 id 为2的文档，所以此次执行返回 not_found，但是不影响后续语句执行</span>
<span class="token punctuation">{</span> <span class="token property">&quot;update&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span>             <span class="token comment">//增量更新了 bulk_index 中 id 为 1 的文档，注意这里的写法是 _id 在前，_index 在后</span>
<span class="token punctuation">{</span> <span class="token property">&quot;doc&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xuweiliang&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>                                 
<span class="token punctuation">{</span> <span class="token property">&quot;index&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;1&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>               <span class="token comment">//Index方式操作了 bulk_index 索引的 id 为 1 的文档，把文档内容改了如下</span>
<span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xuweiliang&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">&quot;create&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>             <span class="token comment">//在 bulk_index 索引中 创建了一个 id 为 2 的文档</span>
<span class="token punctuation">{</span> <span class="token property">&quot;name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;xuweiliang&quot;</span> <span class="token punctuation">,</span> <span class="token property">&quot;Age&quot;</span> <span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">&quot;delete&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>             <span class="token comment">//删除了 bulk_index 索引中 id 为 2的文档</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>使用 <code>bulk api</code> 批量操作的每条语句都会进行返回结果，如下</p> <p><img src="https://blog-1305251267.cos.ap-shenzhen-fsi.myqcloud.com/img/v2-f728c69f7de0a15f5db4ae6b5b2a8f10_1440w.jpeg" alt="v2-f728c69f7de0a15f5db4ae6b5b2a8f10_1440w"></p> <h3 id="mget-批量读取"><a href="#mget-批量读取" class="header-anchor">#</a> <strong>MGET 批量读取</strong></h3> <p>Elasticsearch中提供了 mget 批量读取的方式，批量操作，减少了网络连接所产生的开销。提高性能</p> <p><strong>实例</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>GET _mget
<span class="token punctuation">{</span>
  <span class="token property">&quot;docs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>                                  <span class="token comment">//docs为mget格式</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span><span class="token punctuation">,</span>               <span class="token comment">//指定要读取文档的索引</span>
      <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>                             <span class="token comment">//指定读取文档的ID</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bulk_index&quot;</span><span class="token punctuation">,</span>               <span class="token comment">//同一索引内的不同ID联合读取</span>
      <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">,</span>                    <span class="token comment">//不同索引中的不同ID联合读取</span>
      <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>结果如下：</p> <p><img src="https://blog-1305251267.cos.ap-shenzhen-fsi.myqcloud.com/img/v2-6998bc028d76feabc71b2e5dbf732f9b_1440w.jpeg" alt="v2-6998bc028d76feabc71b2e5dbf732f9b_1440w"></p> <h3 id="msearch-批量查询"><a href="#msearch-批量查询" class="header-anchor">#</a> <strong>MSEARCH 批量查询</strong></h3> <p>msearch全称 Multi Serach API是一个可以进行条件匹配查询的语法 <code>GET /&lt;index&gt;/_msearch</code></p> <p><strong>介绍</strong> mserach官方解释说从单个API中获取多个搜索结果，请求的格式类似于批量API格式，并使用换行符分隔的JSON（NDJSON）格式。最后一行数据必须以换行符 \n 结尾。每个换行符前面都可以有一个回车符 \r。向此端点发送请求时，Content-Type标头应设置为<code>application/x-ndjson</code></p> <p><strong>路径参数</strong> <index> （可选，字符串）索引名称的逗号分隔列表或通配符表达式，用于限制请求。</index></p> <p><strong>请求主体</strong> 1.<code>aggregations</code>聚合 （可选，对象）指定聚合。</p> <p>2.<code>from</code> 来自 （可选，整数）起始文档偏移量。预设为0。</p> <p>3.<code>max_concurrent_searches</code>同时最多查询 （可选，整数）指定多重搜索API将执行的并发搜索的最大数量,此默认值基于数据节点的数量和默认搜索线程池大小。</p> <p>4.<code>max_concurrent_shard_requests</code> （可选，整数）指定每个子搜索请求将在每个节点上执行的并发分片请求的最大数量。此参数应用于保护单个请求，以防止集群过载（例如，默认请求将命中集群中的所有索引，如果每个节点的分片数量很高，则可能导致分片请求被拒绝）。默认为5。在某些情况下，并发请求无法实现并行性，因此这种保护将导致性能下降。例如，在仅期望很少数量的并发搜索请求的环境中，可能有助于将该值增加到更大的数目。</p> <p>5.<code>preference</code> （可选，字符串）指定应该对其执行操作的节点或分片。默认为随机。</p> <p>6.<code>query</code> （可选，查询对象）使用查询DSL定义搜索定义。</p> <p>7.<code>routing</code> （可选，字符串）以指定的主分片为目标。</p> <p>8.<code>search_type</code> （可选，字符串）搜索操作的类型。可用选项：</p> <ul><li>query_then_fetch</li> <li>dfs_query_then_fetch</li></ul> <p>9.<code>size</code> （可选，整数）要返回的点击数。默认为10。</p> <p><strong>响应正文</strong> <code>responses</code> （数组）包括与原始多重搜索请求中的顺序匹配的每个搜索请求的搜索响应和状态代码。如果特定搜索请求完全失败，error则将返回带有消息和相应状态代码的对象，代替实际的搜索响应。</p> <p><strong>实例</strong> 标头部分包括要搜索的一个或多个索引，search_type，首选项和路由。该正文包括典型的搜索正文请求（包括查询，聚合，来源，大小等）。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>$ cat requests
<span class="token punctuation">{</span><span class="token property">&quot;index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;index&quot;</span><span class="token punctuation">}</span>              
<span class="token punctuation">{</span><span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;match_all&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token property">&quot;from&quot;</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">&quot;size&quot;</span> <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;index&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;search_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;dfs_query_then_fetch&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;match_all&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;match_all&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;match_all&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;search_type&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;dfs_query_then_fetch&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;match_all&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="常见错误返回"><a href="#常见错误返回" class="header-anchor">#</a> <strong>常见错误返回</strong></h3> <p><strong>问题原因</strong>无法连接网络故障或集群挂了连接无法关闭网络故障或节点出错429集群过于繁忙4xx请求体格式错误500集群内部错误</p> <h2 id="常用快捷shell处理"><a href="#常用快捷shell处理" class="header-anchor">#</a> 常用快捷shell处理</h2> <h3 id="批量降副本"><a href="#批量降副本" class="header-anchor">#</a> 批量降副本</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>
<span class="token function">curl</span> http://localhost:9200/_cat/indices?v <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">open</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;gb &quot;</span> <span class="token operator">|</span> <span class="token function">sort</span> -k9 <span class="token operator">|</span> <span class="token function">grep</span> api_nginx_access <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> col st index other<span class="token punctuation">;</span>

<span class="token keyword">do</span>

 <span class="token function">curl</span> -XPUT -H<span class="token string">&quot;Content-Type: application/json; charset=utf-8&quot;</span> http://localhost:9200/<span class="token variable">$index</span>/_settings -d<span class="token string">'{&quot;index&quot;: {&quot;number_of_replicas&quot;: &quot;0&quot;}}'</span><span class="token punctuation">;</span>

<span class="token keyword">done</span><span class="token punctuation">;</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="创建账号密码"><a href="#创建账号密码" class="header-anchor">#</a> 创建账号密码</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> -X <span class="token string">&quot;POST&quot;</span> <span class="token string">&quot;http://loclahost:9200/_security/user/test&quot;</span> <span class="token punctuation">\</span>
     -H <span class="token string">'Content-Type: application/json; charset=utf-8'</span> <span class="token punctuation">\</span>
     -u <span class="token string">'elastic:password'</span> <span class="token punctuation">\</span>
     -d <span class="token string">$'{
  &quot;password&quot;: &quot;xxxxxxxx-xxxxxxxxx&quot;,
  &quot;full_name&quot;: &quot;test&quot;,
  &quot;roles&quot;: [
    &quot;superuser&quot;
  ],
  &quot;email&quot;: &quot;test@xx.com&quot;
}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="清理索引"><a href="#清理索引" class="header-anchor">#</a> 清理索引</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#清理skywalking 索引</span>
<span class="token function">curl</span> -s -XGET -u user:passwod http://localhost:9200/_cat/indices<span class="token operator">|</span><span class="token function">grep</span> -E <span class="token string">'skywalk_[a-zA-Z_]+-20210[0-4][0-9]{0,2}'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print $3}'</span><span class="token operator">|</span><span class="token keyword">while</span> <span class="token builtin class-name">read</span> index
<span class="token keyword">do</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;[<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> +<span class="token string">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="token variable">`</span></span>] INFO delete index: <span class="token variable">$index</span>&quot;</span>
    <span class="token function">curl</span> -s -XDELETE -u user:passwod http://localhost:9200/<span class="token variable">$index</span>   
<span class="token keyword">done</span>

<span class="token comment"># 常用的日期正则</span>
<span class="token function">egrep</span> <span class="token string">'14-DI_SEQ_SQL_SUBSCRIBE_LIBRARY-202108(0[1-9]|1[1-5])'</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="统计某类索引空间大小"><a href="#统计某类索引空间大小" class="header-anchor">#</a> 统计某类索引空间大小</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> -s -XGET -u user:password <span class="token string">&quot;http://localhost:9200/_cat/indices/skywalk*?v&amp;bytes=gb&amp;s=store.size:desc&amp;h=store.size&quot;</span><span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{sum+=$1}END{print sum}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="elasticsearch查询文档总数"><a href="#elasticsearch查询文档总数" class="header-anchor">#</a> <a href="https://www.cnblogs.com/jamh/p/14975903.html" target="_blank" rel="noopener noreferrer">Elasticsearch查询文档总数<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/chenhaipeng/edit/master/docs/02.大数据/01.Elasticsearch文章/05.Elasticsearch 常用命令.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/04, 16:44:21</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/aa5cb7/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Elasticsearch 架构</div></a> <a href="/pages/c0183f/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Elasticsearch 集群迁移</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/aa5cb7/" class="prev">Elasticsearch 架构</a></span> <span class="next"><a href="/pages/c0183f/">Elasticsearch 集群迁移</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/b36b1d/"><div>
            单例模式
            <!----></div></a> <span class="date">06-13</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/baaad2/"><div>
            生产者消费者模式
            <!----></div></a> <span class="date">06-13</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4bb148/"><div>
            性能测试一些概念
            <!----></div></a> <span class="date">06-13</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:369161356@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/chenhaipeng" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2022
    <span>Hiper | <a href="https://github.com/chenhaipeng/chenhaipeng.github.io/blob/main/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><span class="close-but">×</span> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.d3e05205.js" defer></script><script src="/assets/js/2.fe8aed19.js" defer></script><script src="/assets/js/16.3a2f9fc9.js" defer></script>
  </body>
</html>
