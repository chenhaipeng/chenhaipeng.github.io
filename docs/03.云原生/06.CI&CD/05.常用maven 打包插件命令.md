

## 常用的打包插件

### makefile

```makefile
.PHONY: all api
all: api
api:
   @echo "[open-apm] building..."
   @mvn clean package -Dmaven.test.skip=true -am --settings settings.xml
   @rm -rf build
   @mkdir -p build
   @cp target/open-apm-1.0.0-SNAPSHOT.jar ./build/open-apm-1.0.0-SNAPSHOT.jar
   @echo "[open-apm] build finish!"
```



### springboot 

#### fatjar

```xml
<plugin>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-maven-plugin</artifactId>
    <configuration>
        <excludes>
            <exclude>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
            </exclude>
        </excludes>
    </configuration>
</plugin>
```



#### fatjar 与lib 配置分离

```xml
<build>
   <plugins>
      <plugin>
         <groupId>org.apache.maven.plugins</groupId>
         <artifactId>maven-jar-plugin</artifactId>
         <version>3.0.0</version>
         <configuration>
            <includes>
               <include>**/*.class</include>
            </includes>
         </configuration>
      </plugin>
      <plugin>
         <artifactId>maven-assembly-plugin</artifactId>
         <version>2.6</version>
         <configuration>
            <appendAssemblyId>false</appendAssemblyId>
            <descriptor>src/main/assembly/assembly.xml</descriptor>
            <tarLongFileMode>posix</tarLongFileMode>
         </configuration>
         <executions>
            <execution>
               <id>assembly</id>
               <phase>package</phase>
               <goals>
                  <goal>single</goal>
               </goals>
            </execution>
         </executions>
      </plugin>
   </plugins>
</build>
```



##### assembly.xml

```xml
<assembly>
   <id>bin</id>
   <formats>
      <format>tar.gz</format>
   </formats>
   <dependencySets>
      <dependencySet>
         <useProjectArtifact>true</useProjectArtifact>
         <outputDirectory>lib</outputDirectory>
      </dependencySet>
   </dependencySets>
   <fileSets>
      <fileSet>
         <directory>src/main/resources</directory>
         <outputDirectory>confStr</outputDirectory>
         <includes>
            <include>*.properties</include>
            <include>*.xml</include>
            <include>*.graphqls</include>
         </includes>
      </fileSet>
      <fileSet>
         <directory>src/main/resources/script</directory>
         <outputDirectory>bin</outputDirectory>
         <includes>
            <include>*.sh</include>
         </includes>
         <fileMode>0755</fileMode>
      </fileSet>
   </fileSets>
</assembly>
```

